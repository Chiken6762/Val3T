<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Tic-Tac-Toe Football</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                text-align: center;
            }
            .board {
                display: grid;
                grid-template-columns: repeat(3, 100px);
                gap: 5px;
                justify-content: center;
                margin-top: 20px;
            }
            .cell {
                width: 100px;
                height: 100px;
                font-size: 24px;
                display: flex;
                align-items: center;
                justify-content: center;
                border: 2px solid black;
                cursor: pointer;
            }
            .cell.taken {
                background-color: lightgray;
                cursor: not-allowed;
            }
            .question-container {
                margin-top: 20px;
            }
            #answerBox {
                margin-top: 10px;
                padding: 5px;
            }
        </style>
    </head>
    <body>
        <h1>Tic-Tac-Toe Football</h1>
        <label
            >Player 1: <input type="text" id="player1" placeholder="Enter name"
        /></label>
        <label
            >Player 2: <input type="text" id="player2" placeholder="Enter name"
        /></label>
        <button onclick="startGame()">Start Game</button>
        <h2 id="turn">Enter Player Names to Start</h2>
        <div class="board" id="board"></div>
        <div class="question-container">
            <p id="questionText">Click a box to get a question.</p>
            <input type="text" id="answerBox" placeholder="Enter your answer" />
            <button onclick="submitAnswer()">Submit</button>
        </div>
        <script>
            let currentPlayer;
            let players = {};
            let board;
            let playerConnections = [];
            let selectedCell = null;
            let currentQuestion = "";
            let correctAnswers = new Set();

            function loadCSV() {
                fetch("Book3.csv")
                    .then((response) => response.text())
                    .then((data) => {
                        let rows = data
                            .split("\n")
                            .map((row) => row.split(","));
                        rows.slice(1).forEach((row) => {
                            if (
                                row.length < 4 ||
                                !row[0] ||
                                !row[1] ||
                                !row[2] ||
                                !row[3]
                            )
                                return;
                            let name = row[0].trim().toLowerCase();
                            let team1 = row[1].trim();
                            let team2 = row[2].trim();
                            let country = row[3].trim();
                            playerConnections.push({
                                name,
                                team1,
                                team2,
                                country,
                            });
                        });
                        console.log("CSV Loaded:", playerConnections);
                    })
                    .catch((error) =>
                        console.error("Error loading CSV:", error),
                    );
            }

            function startGame() {
                const p1 = document.getElementById("player1").value;
                const p2 = document.getElementById("player2").value;
                if (!p1 || !p2) {
                    alert("Both players must enter names!");
                    return;
                }
                players = { X: p1, O: p2 };
                board = Array(3)
                    .fill()
                    .map(() => Array(3).fill(""));
                currentPlayer = "X";
                document.getElementById("turn").innerText =
                    `${players[currentPlayer]}'s Turn (${currentPlayer})`;
                generateBoard();
            }

            function generateBoard() {
                const boardDiv = document.getElementById("board");
                boardDiv.innerHTML = "";
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        let cell = document.createElement("div");
                        cell.classList.add("cell");
                        cell.dataset.row = i;
                        cell.dataset.col = j;
                        cell.onclick = askQuestion;
                        boardDiv.appendChild(cell);
                    }
                }
            }

            function askQuestion(event) {
                if (selectedCell) return;
                selectedCell = event.target;
                let row = selectedCell.dataset.row;
                let col = selectedCell.dataset.col;
                if (board[row][col] !== "") return;

                let randomEntry =
                    playerConnections[
                        Math.floor(Math.random() * playerConnections.length)
                    ];
                if (!randomEntry || !randomEntry.country || !randomEntry.team2)
                    return;

                let questionType = Math.random() < 0.5 ? "team" : "country";
                if (questionType === "team") {
                    currentQuestion = `Name a player who has played for ${randomEntry.team2}.`;
                    correctAnswers = new Set(
                        playerConnections
                            .filter((p) => p.team2 === randomEntry.team2)
                            .map((p) => p.name),
                    );
                } else {
                    currentQuestion = `Name a player who is from ${randomEntry.country} and has played for ${randomEntry.team2}.`;
                    correctAnswers = new Set(
                        playerConnections
                            .filter(
                                (p) =>
                                    p.country === randomEntry.country &&
                                    p.team2 === randomEntry.team2,
                            )
                            .map((p) => p.name),
                    );
                }
                document.getElementById("questionText").innerText =
                    currentQuestion;
            }

            function submitAnswer() {
                if (!selectedCell || !currentQuestion) return;
                let answer = document
                    .getElementById("answerBox")
                    .value.trim()
                    .toLowerCase();
                if (correctAnswers.has(answer)) {
                    let row = selectedCell.dataset.row;
                    let col = selectedCell.dataset.col;
                    board[row][col] = currentPlayer;
                    selectedCell.innerText = currentPlayer;
                    selectedCell.classList.add("taken");
                    selectedCell.onclick = null;
                    if (checkWinner()) {
                        document.getElementById("turn").innerText =
                            `${players[currentPlayer]} Wins!`;
                        document
                            .querySelectorAll(".cell")
                            .forEach((c) => (c.onclick = null));
                        return;
                    }
                    currentPlayer = currentPlayer === "X" ? "O" : "X";
                    document.getElementById("turn").innerText =
                        `${players[currentPlayer]}'s Turn (${currentPlayer})`;
                } else {
                    alert("Incorrect answer! Try again.");
                }
                document.getElementById("answerBox").value = "";
                selectedCell = null;
                currentQuestion = "";
                document.getElementById("questionText").innerText =
                    "Click a box to get a question.";
            }

            function checkWinner() {
                for (let i = 0; i < 3; i++) {
                    if (
                        board[i][0] &&
                        board[i][0] === board[i][1] &&
                        board[i][1] === board[i][2]
                    )
                        return true;
                    if (
                        board[0][i] &&
                        board[0][i] === board[1][i] &&
                        board[1][i] === board[2][i]
                    )
                        return true;
                }
                return (
                    (board[0][0] &&
                        board[0][0] === board[1][1] &&
                        board[1][1] === board[2][2]) ||
                    (board[0][2] &&
                        board[0][2] === board[1][1] &&
                        board[1][1] === board[2][0])
                );
            }

            window.onload = loadCSV;
        </script>
    </body>
</html>
